@using Shared.Application.Utility
@using Microsoft.AspNetCore.Mvc.TagHelpers
@using Shared.Domain.Enums
@model Blogs1.Application.Contract.BlogService.Query.FilteredBlogQueryModel?
@{
	ViewData["Title"] = "مدیریت مقاله ها";
	ViewData["Selected"] = "Blogs";

	var counter = Model?.Skip ?? 0;

}

<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-header">
				<div>
					<form class="form-inline ml-3  float-sm" asp-controller="Blogs" asp-action="Index" method="get">
						@Html.EditorFor(x => x.Take)
						<input class="form-control " type="search" placeholder="عنوان مقاله را وارد کنید ..." aria-label="Search" name="q" value="@Model?.FilterParams.Title">
						<button class="btn btn-sm btn-primary "  type="submit">
							<i class="fa fa-search">جستجو</i>
						</button>
						
					</form>

				</div>

				<hr/>
				<div class="row">
					<div class=" ">
						<a class="btn btn-success " style="width: 300px; margin-right:10px" asp-action="Create">
							<i class="fa fa-plus"></i>
							مقاله جدید
						</a>
						<a title="Seo برای کل مقاله های سایت" class="btn btn-warning " href="/admin/seo/0/@WhereSeo.Blog">
							SEO
						</a>
					</div>
					
					<div class=" ">
						
					</div>

				</div>


			</div>
			<!-- /.box-header -->
			<div class="box-body">
				<div class="table-responsive-md">
					<div class="table-responsive-md">
						<table class="table table-bordered text-sm table-sm  table-striped ">

							<thead class="">

								<tr>
									<th class="">#</th>
									<th class="col-2">عکس</th>
									<th class="col-2">عنوان</th>
									<th class="col-2">دسته بندی</th>
									<th class="col-2">تاریخ ثبت</th>
									<th class="col-2">تاریخ ویرایش</th>
									<th class="col-1">پست ویژه</th>
									<th class="col-4">عملیات</th>
								</tr>

							</thead>
							<tbody>

								@if (Model?.Blogs != null && Model.Blogs.Any())
								{
									@foreach (var blog in Model.Blogs)
									{
										<tr>
											<td>@(counter += 1)</td>

											<td>
												<img src="@Directories.GetBlogImageFullPath(@blog.ImageName,100)" width="100" height="100" alt="@blog.ImageAlt" />
											</td>
											<td>
												@blog.Title.ToShortText()
												@if (blog.Active)
												{
													<span class="text-success text-bold">(فعال)</span>
												}
												else
												{
													<span class="text-danger text-bold">(غیر فعال)</span>
												}
											</td>

											<td>
												<ul>

													<strong>
														@blog?.CategoryTitle
													</strong>
													<li class="mr-5 p-2">
														@blog?.SubCategoryTitle
													</li>
												</ul>
											</td>
											<td>
												@blog.CreateDate
											</td>
											<td>
												@blog.UpdateDate
											</td>
											<td class="mr-3 mt-3">
												@if (blog.IsSpecial)
												{
													<i class="fa fa-check checked bg-success"></i>

												}
												else
												{
													<i class="fa fa-close  bg-danger"></i>
												}
												@{

													string title = blog.IsSpecial ? "پست عادی شود؟" : "پست ویژه شود؟";
													string text = blog.IsSpecial ? "با این کار این پست دیگر در بخش پست های ویژه نمایش داده نمیشود." : "با این کار این پست در بخش پست های ویژه نمایش داده میشود.";
													string confirmText = blog.IsSpecial ? "بله پست عادی شود" : " بله پست ویژه  شود";
													string cancelText = blog.IsSpecial ? "پست ویژه باقی بماند" : "پست عادی باقی بماند";

												}
												<a class="btn btn-action" onclick="sweetAlertConfirm('@title','@text','@confirmText','@cancelText',event)" asp-action="ChangeSpecialation" asp-route-blogId="@blog.Id" asp-route-pageId="@Model.FilterParams.PageId">تغییر؟</a>
											</td>


											<td class="btn-group-sm">

												<a title="ویرایش این مقاله" class="btn   btn-warning mr-1" asp-action="Edit" asp-route-id="@blog.Id">
													<i class="fa fa-edit"></i>
												</a>

												<a title="Seo برای این مقاله" class="btn   btn-warning mr-1" href="/admin/seo/@blog.Id/@WhereSeo.Blog">
													seo
												</a>

												<a class="btn btn-info mr-1 pr-3 pl-3" href="/blogs/blog/@blog.Slug">دیدن مقاله</a>
												@*	<a class="btn btn-danger mr-1" href="javascript:void(0);" onclick="Delete(@postDto?.Id)"> حذف</a>*@
												@if (@blog.Active)
												{
													<a class="btn   btn-danger mr-1" onclick="sweetAlertConfirmLink(event,'با این کار این پست از حالت نمایش در سایت خارج میشود')" asp-action="ChangeActivation" asp-route-blogId="@blog.Id" asp-route-pageId="@Model.FilterParams.PageId">
														غیر فعال کردن
													</a>
												}
												else
												{
													<a class="btn   btn-success mr-1" onclick="sweetAlertConfirmLink(event,'با انی کار این مقاله فعال شده و در وبلاگ نمایش داده میشود')" asp-action="ChangeActivation" asp-route-blogId="@blog.Id" asp-route-pageId="@Model.FilterParams.PageId">
														فعال کردن
													</a>
												}
											</td>
										</tr>


									}
								}
								else
								{
									<h1>چیزی برای نمایش وجود ندارد...</h1>
								}

							</tbody>
						</table>
					</div>

				</div>

				<div class=" text-start">
					
					@if (Model?.TotalPages > 1)
					{
						<div class="row">
							<ul class="pagination pagination-sm " style="margin-right: 500px">
								@if (Model.CurrentPage > 1)
								{
									<li class="page-item"><a  class="page-link" asp-area="Admin" asp-controller="Blogs" asp-action="Index" asp-route-pageId="@(Model.CurrentPage-1)" asp-route-q="@Model.FilterParams.Title" asp-route-take="@Model.Take">&laquo;</a></li>
								}
								@for (var i = Model.StartPage; i <= Model.EndPage; i++)
								{
									<li class="page-item @((Model.CurrentPage == i ? "active" : " "))" ><a href="/Admin/Blogs?pageId=@i&q=@Model.FilterParams.Title&take=@Model.Take" class="page-link" @((Model.CurrentPage == i ? "class='bg-primary'" : "")) @((i == Model.CurrentPage ? "class='disabled-link'" : ""))>@i</a></li>
								}
								@if (Model.CurrentPage < Model.EndPage)
								{
									<li class="page-item"><a  class="page-link" asp-area="Admin" asp-controller="Blogs" asp-action="Index" asp-route-pageId="@(Model.CurrentPage+1)" asp-route-q="@Model.FilterParams.Title" asp-route-take="@Model.Take">&raquo;</a></li>
								}

							</ul>
						</div>

					}

				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts{

					<script>


						function sweetAlertConfirm(title, text, confirmText, cancelText, event) {

							event.preventDefault();

							Swal.fire({
								title: title,
								text: text,
								icon: "warning",
								confirmButtonText: confirmText,
								showCancelButton: true,
								cancelButtonText: cancelText,
							}).then((willConfirm) => {
								if (willConfirm.value) {
									window.location.href = event.target.href;
								} else {
									return;
								}
							});


						}

					</script>

				}