@using Shared.Application.Utility
@model Blogs1.Application.Contract.BlogCategoryService.Query.FilteredBlogCategoryQueryModel?


@{
	ViewData["Title"] = "مدیریت دسته بندی ها";
	ViewData["Selected"] = "BlogCategories";
	var counter = 0;
}

<form class="form-inline ml-3  float-sm" asp-controller="Categories" asp-action="Index"  method="get">
	<div class="input-group input-group-sm " style=" display: flex;
	                                                align-items: center; width: 300px; margin-right: 400px; padding : 10px"  >
		
		<input class="form-control "  type="search" placeholder="جستجو کنید..." aria-label="Search" name="q" value="@Model?.FilterParams.Title">
		<button class="btn btn-sm btn-success " style="margin-right: 6px" type="submit">
			<i class="fa fa-search">جستجو</i>
		</button>
		<div class="input-group-append ">

		</div>
	</div>
	<hr>
</form>
<br>
<div class="row">
	<div class=" col-lg-3"></div>
	<a class="btn   btn-primary mt-5 col-lg-6 " asp-action="Create">
		افزودن دسته بندی جدید
	</a>
	<div class=" col-lg-3"></div>

</div>
<hr>

<div class="table-responsive-md">
	<table class="table table-bordered text-sm table-sm  table-hover ">

		<thead class="">

		<tr>
			<th class="">#</th>
			<th class="col-2">عنوان دسته بندی </th>
			<th class="col-2">تصویر</th>
			<th class="col-2">زیر گروه ها</th>
			<th class="col-4">عملیات</th>
		</tr>

		</thead>
		<tbody>

		@if (Model?.BlogCategories != null && Model.BlogCategories.Any())
		{
			@foreach (var blogCategory in Model.BlogCategories)
			{
				<tr>
					<td>@(counter += 1)</td>

					<td>
						@blogCategory.Title
						@if (blogCategory.IsActive)
						{
							<span class="text-success text-bold">(فعال)</span>
						}
						else
						{
								<span class="text-danger text-bold">(غیر فعال)</span>
						}
					</td>
					<td>
						<img src="@Directories.GetBlogCategoryImageFullPath(@blogCategory.ImageName,100)" width="100" height="100" alt="@blogCategory.ImageAlt" />
					</td>

					<td>
							

						<ul>
							@if (blogCategory.SubCategories != null && blogCategory.SubCategories.Any())
							{

								foreach (var subCategory in blogCategory.SubCategories)
								{

									<li style="margin-top: 5px">
										<span ></span>@subCategory.Title
										@if (subCategory.IsActive)
										{
											<span class="text-success text-bold">(فعال)</span>
										}
										else
										{
												<span class="text-danger text-bold">(غیر فعال)</span>
										}
										
										@if (@subCategory.IsActive)
										{
												<a class="btn  btn-sm btn-danger " onclick="sweetAlertConfirmSubmit(event,'با این کار تمام زیر گروه های این دسته بندی غیر فعال میشوند. آیا مطمعنید؟')" asp-action="ChangeActivation" asp-route-categoryId="@subCategory.Id" asp-route-pageId="@Model.FilterParams.PageId">
												غیر فعال کردن
											</a>
										}
										else
										{
												<a class="btn btn-sm  btn-success " onclick="sweetAlertConfirmSubmit(event)" asp-action="ChangeActivation" asp-route-categoryId="@subCategory.Id" asp-route-pageId="@Model.FilterParams.PageId">
												فعال کردن
											</a>
										}
											<a class="btn   btn-sm btn-primary mr-1 col-1" asp-action="Edit" asp-route-id="@subCategory.Id">
												ویرایش
											</a>
									</li>
								
								
								}
							}
						</ul>
					</td>

					<td class="btn-group-sm">
						
						@if (@blogCategory.IsActive)
						{
								<a class="btn   btn-danger mr-1" onclick="sweetAlertConfirmSubmit(event,'با این کار تمام زیر گروه های این دسته بندی غیر فعال میشوند. آیا مطمعنید؟')" asp-action="ChangeActivation" asp-route-categoryId="@blogCategory.Id" asp-route-pageId="@Model.FilterParams.PageId">
								غیر فعال کردن
							</a>
						}
						else
						{
								<a class="btn   btn-success mr-1" onclick="sweetAlertConfirmSubmit(event)" asp-action="ChangeActivation" asp-route-categoryId="@blogCategory.Id" asp-route-pageId="@Model.FilterParams.PageId">
								فعال کردن
							</a>
						}

						<a class="btn   btn-primary mr-1" asp-action="Edit" asp-route-id ="@blogCategory.Id" >
							ویرایش
						</a>

							<a class="btn   btn-success mr-1" asp-action="Create" asp-route-parentId="@blogCategory.Id">
								افزودن زیرگروه
							</a>
							

						<div class="modal fade" id="createBlogCategoryModal" tabindex="-1" role="dialog" aria-labelledby="createBlogCategoryModal" aria-hidden="true">
						</div>



					</td>
				</tr>


			}

			
				
		}
		else
		{
			<h1>چیزی برای نمایش وجود ندارد...</h1>
		}

		</tbody>
	</table>
</div>

@if (Model?.TotalPages > 1)
{
	<div class="row">
		<ul class="pagination pagination-sm " style="margin-right: 500px">
			@if (Model.CurrentPage > 1)
			{
				<li class="page-item"><a disabled class="page-link" asp-area="Admin" asp-controller="Categories" asp-action="Index" asp-route-pageId="@(Model.CurrentPage-1)" asp-route-q="@Model.FilterParams.Title" >&laquo;</a></li>
			}
			@for (var i = Model.StartPage; i <= Model.EndPage; i++)
			{
				<li class="page-item "@((Model.CurrentPage == i ? "class='bg-primary'" : ""))><a href="/Admin/Categories?pageId=@i&q=@Model.FilterParams.Title" class="page-link"  @((i == Model.CurrentPage ? "class='disabled-link'" : ""))>@i</a></li>
			}
			@if (Model.CurrentPage < Model.EndPage)
			{
				<li class="page-item"><a disabled class="page-link" asp-area="Admin" asp-controller="Categories" asp-action="Index" asp-route-pageId="@(Model.CurrentPage+1)" asp-route-q="@Model.FilterParams.Title">&raquo;</a></li>
			}

		</ul>
	</div>

}



@section Scripts
{
	
	
	
	<script>


		function OpenCreateCategoryModal(event) {

			$.ajax({
				url: "/Admin/Categories/GoToCreateModal",
				type: "get",

			}).done(function(data) {
				$("#createBlogCategoryModal").html(data);
			});

		}

		function sweetAlertConfirmSubmit(event,text) {

			console.log(text);
			event.preventDefault();
			if (text == "")
				text = "آیا از انجام عملیات اطمینان دارید ؟";
				Swal.fire({
				title: "هشدار !!",
				text:  text,
				icon: "warning",
				confirmButtonText: "بله",
				showCancelButton: true,
				cancelButtonText: "خیر",
			}).then((willConfirm) => {
				if (willConfirm.value) {
					window.location.href = event.target.href; 
				} else {
					return;
				}
			});
		}
	</script>
}
