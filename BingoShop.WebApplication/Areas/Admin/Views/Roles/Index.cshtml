@using Shared.Application.Utility
@model List<Users1.Application.Contract.RoleService.Query.RoleQueryModel>?

@{
	ViewData["Title"] = "مدیریت نقش ها";
	ViewData["Selected"] = "Roles";
	var counter = 0;
}


<div class="row">
	<div class="col-xs-12">
		<div class="box">
			<div class="box-header">
				<div class="col-xs-3"><div class="row">
				
					<a class="btn   btn-success mt-5 " onclick="goToCreateRoleModal()"
						   data-toggle="modal" data-target="#createRoleModal">
							<i class=" fa fa-plus"></i>
						 نقش جدید
					</a>
					

				</div></div>
				<div class="col-xs-6 ">
				
				</div>
			</div>
			<!-- /.box-header -->
			<div class="box-body">

				<div class="table-responsive-md">
					<table class="table table-bordered table-striped ">

						<thead class="">

						<tr>
							<th class="">#</th>
							<th class="col-2">عنوان نقش </th>
							<th class="col-2"> دسترسی های نقش </th>
							<th class="col-2">کاربران</th>
							<th class="col-4">عملیات</th>
						</tr>

						</thead>
						<tbody>

						@if (Model != null && Model.Any())
						{
							@foreach (var role in Model)
							{
								<tr>
									<td>@(counter += 1)</td>

									<td>
										@role.Title
									</td>
									<td>

					
										@if (role.Permissions.Any())
										{


											<ul>
												@foreach (var permission in @role.Permissions)
												{

													<li>
														@permission.UserPermission
													</li>

												}
											</ul>

										}
									</td>
									<td>
										<ul>
											@if (role.UserRoles != null && role.UserRoles.Any())
											{
												@foreach (var userRole in @role.UserRoles)
												{

													<li>
														@((userRole.User.FullName == "" ? userRole.User.UserName : userRole.User.FullName))
														<a class=" btn btn-primary" asp-controller="Users" asp-route-q="@userRole.User.Mobile.Trim()"> <i class="fa fa-user"></i></a>
													</li>

												}
											}
						
										</ul>
							
									</td>

									<td class="btn-group-sm">

										<a title="ویرایش این نقش" class="btn   btn-warning mr-1" onclick="getRoleForEdit('@role.Id')"
										   data-toggle="modal" data-target="#editRoleModal"><i class="fa fa-edit"></i>
										
										</a>

										<div class="modal fade" id="editRoleModal"  tabindex="-1" role="dialog" aria-labelledby="editRoleModalLabel" aria-hidden="true">
										</div>

										<div class="modal fade" id="createRoleModal" tabindex="-1" role="dialog" aria-labelledby="createRoleModalLabel" aria-hidden="true">
										</div>

									</td>
								</tr>


							}
						}
						else
						{
							<h1>چیزی برای نمایش وجود ندارد...</h1>
						}

						</tbody>
					</table>
				</div>


			</div>
		</div>
	</div>
</div>

@section Scripts
							{

								<script>


									function getRoleForEdit(roleId) {

										$.ajax(
											{
												url: `/Admin/Roles/EditRole?roleId=${roleId}`,
												type: "get",
												error: function(data) {
													ErrorAlert("مشکلی در اعملیات رخ داده", "لطفا در زمان دیگری امتحان کنید");
												}
											}
										).done(function(data) {

			                            	$("#editRoleModal").html('');
											$("#editRoleModal").append(data);

										});

									}

function goToCreateRoleModal() {

	$.ajax(
		{
			url: `/Admin/Roles/CreateRole`,
			type: "get",
			error: function(data) {
				ErrorAlert("مشکلی در اعملیات رخ داده", "لطفا در زمان دیگری امتحان کنید");
			}
		}
	).done(function(data) {

		$("#createRoleModal").html('');
		$("#createRoleModal").append(data);

	});

}

								</script>

							}
